<!DOCTYPE html>
<html>
  <html lang="en">
  <head>
      <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <title>Mess with Google Analytics goals and don't lose data.</title>
      <meta name="viewport" content="width=device-width">
      <meta name="description" content="front-end developer who blogs about shit everyone knows already">
      <link rel="stylesheet" href="/assets/css/syntax.css">
      <link rel="stylesheet" href="/assets/css/main.css">
  </head>
  <body>
    <div class="container">
      <main><article>
  <header>
    <h1>Mess with Google Analytics goals and don't lose data.</h1>
    <time>12 Jul 2014</time>
  </header>
  <p>The more you touch computers the more you&#39;ll find yourself at a loss without some knowledge of regular expressions.  It&#39;s definitely a bit of a steep learning curve, but the benefits are huge.  Even as a front-end web tech I frequently deploy regex for find/replace when overhauling selectors.  Eg: match all elements in your html that have a class of &quot;button&quot; or &quot;button-[something]&quot;?</p>

<p><code>class=&quot;([a-zA-Z0-9 ]+)?button.+?&quot;</code></p>

<p>Quick def: <em>Regular expressions are a character-based pattern-matching notation</em>.  More naturally explained, you can write very small code to handle complex string handling. Take this example regex that matches for valid email addresses:</p>

<p><code>^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,6}$</code></p>

<p>Just 40 characters!  No need for functions, comparison operators, String APIs. </p>

<p>One common scenario where regex is utilized by a non-programmer, such as growth marketers, is configuring destination matches for Google Analytics goals.  </p>

<p><img src="/assets/images/google_analytics_goal_matchers.png" alt="Google Analytics goal matchers"></p>

<p>Google is nice enough to give you two non-programmatic matching options, &quot;Equals to&quot; and &quot;Begins with&quot;.  These are a good start for simple sites.  But complex apps often architect multiple funnel destinations to support different conversion actions.  For example, at Science Exchange we track conversions for requesting a service, submitting a quote, quote acceptance, project completion, payment, etc...  For a product like ours, using Google&#39;s basic destination matching options is too simplistic.  </p>

<p>Even attempting to match for one of these conversion points, like service requests, we need a regex.  Here&#39;s what a the confirmation path looks like for a newly requested service: </p>

<p><code>/projects/35510/confirmaton</code></p>

<p>Straight forward, but we have a variable length project ID in the second segment.  Google&#39;s <em>prete-a-porter</em> options don&#39;t satisfy our needs.  Instead, we need a regex character class to help:</p>
<div class="highlight"><pre><code class="bash language-bash" data-lang="bash"><span class="c"># Service request destination regex</span>
/projects/<span class="se">\d</span>+/confirmation
</code></pre></div>
<p>Let&#39;s take a look. First, <code>\d</code> is a character class alias for <code>[0-9]</code>, and tells the regex engine to match any integer.  A backslash is used to identify the lowercase d as a special character class, and not the letter <em>d</em> which may or may not be part of our string.  Second, the <code>+</code> means &quot;one or more,&quot; and tells the regex engine to continue matching forward until it reaches a non-number.</p>

<h3>I was scared at first, then regex gave me the courage</h3>

<p>Confirmation pages are often pointless [happy talk)[http://blog.codinghorror.com/happy-talk-must-die/] wastelands that short-circuit a user experience.  As part of a recent usability overhaul to our service request flow, we eliminated the confirmation page entirely.</p>

<p>But that meant we needed to change how we were tracking the service request goal in Google Analytics.  Without a pageview to send a beacon, Here&#39;s what we came up with:</p>
<div class="highlight"><pre><code class="bash language-bash" data-lang="bash"><span class="c"># Updated service request destination regex</span>
/projects/<span class="se">\d</span>+/confirmation<span class="p">|</span>/projects/<span class="se">\d</span>+<span class="se">\?</span>.*confirmation<span class="o">=</span><span class="nb">true</span>
</code></pre></div>
<p>The first part should look familiar.  That&#39;s our old regex! After that segment you see a <code>|</code> symbol.  This is an &quot;or&quot; operand - which will be familiar if you write code.  Ok, this is big.  An &quot;or&quot; operand in this regex means we don&#39;t have to fear losing historical data by modifying this goal.  Backwards compatibility, son!  When Mike typed that pipe in there it was like wow.  Thanks, Mike.</p>

</article>

<nav>
  
    <a class="previous" href="/ross-biggie-mashup/"><span class="arrow">&#10140;</span></a>
  
  
</nav>

<footer><nav>
  
    <a href="/jquery" class="category-nav-item">#jquery</a>
  
    <a href="/rails" class="category-nav-item">#rails</a>
  
    <a href="/backbone" class="category-nav-item">#backbone</a>
  
    <a href="/jekyll" class="category-nav-item">#jekyll</a>
  
    <a href="/sass" class="category-nav-item">#sass</a>
  
    <a href="/javascript" class="category-nav-item">#javascript</a>
  
    <a href="/css" class="category-nav-item">#css</a>
  
    <a href="/conferences" class="category-nav-item">#conferences</a>
  
    <a href="/mashups" class="category-nav-item">#mashups</a>
  
    <a href="/google analytics" class="category-nav-item">#google analytics</a>
  
    <a href="/regex" class="category-nav-item">#regex</a>
  
</nav></footer></main>
      <aside>
        <a href="/"><img class="gravatar" src="http://d2ybgnpt0qry0r.cloudfront.net/img/rossy-smalls.png" width="260" height="260"/></a>
        <h1>About Me</h1>
        <p>I'm a web developer who works on the front parts of <a href="http://www.scienceexchange.com">Science Exchange</a>, an online marketplace for scientific collaboration.  I hope my work will quickly lead to the invention of the hover board and hyposprays. Like, <em>quickly</em>.</p>
        <p class="social">
          <a href="http://twitter.com/internetross">twitter</a>
          <a href="www.linkedin.com/in/rosschapmanâ€Ž">linkedin</a>
        </p>
      </aside>
    </div>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-43971638-1');
      ga('send', 'pageview');
    </script>
  </body>
</html>
