<!DOCTYPE html>
<html>
  <html lang="en">
  <head>
      <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <title>console.log('meh') and rotating images in Rails.</title>
      <meta name="viewport" content="width=device-width">
      <meta name="description" content="front-end developer who blogs about shit everyone knows already">
      <link rel="stylesheet" href="/assets/css/syntax.css">
      <link rel="stylesheet" href="/assets/css/main.css">
  </head>
  <body>
    <div class="container">
      <main><article>
  <header>
    <h1>console.log('meh') and rotating images in Rails.</h1>
    <time>17 May 2014</time>
  </header>
  <p>First, a brief PSA, just in case it was unclear.  HTML5 is <a href="http://blog.whatwg.org/html-is-the-new-html5">over</a>.</p>

<p><strong>console.log(&#39;meh&#39;)</strong></p>

<p><img src="/assets/images/debugger-is-cool.jpg" alt="Alt text"></p>

<p>I rely less and less on <code>console.log</code> these days.  If you haven&#39;t been introduced, meet <code>debugger</code>.  Simply toss a <code>debugger;</code> statement in Chrome at the end of an expression and you get everything you need: omnipotent access to the call stack, scope variables, your manual watch expressions.  Even just hover over variables to see their values.  No need to gun splatter your expressions with log statements - how many have you have left dangling in pull requests?  Too many.</p>

<p><strong>Caching for rotating images</strong></p>

<p>Yeah, so cache all the things.  Of course.  Except, maybe like me, you&#39;ve been in a situation where you wanted fragment cache blocks wrapping dynamic or even <a href="http://d.alistapart.com/randomizer/rotate.txt"><em>rotating</em></a> content.  It&#39;s slightly throwback, but on Science Exchange&#39;s homepage we are rotating the banner image on load to showcase a set of featured labs who are...ya know...killing it.  We love our featured labs enough not to play favorites with a carousel - in addition to keeping the focus on the search bar which is the paramount CTA.  Nevertheless, a little delight for return visitors was in order so a rotating image was the chosen pattern.</p>

<p>Inside that banner area there are a few dynamic strings that load with the image pulled from a <code>@random_lab</code> instance object.  However, the banner is loaded separately inside a <code>content_for</code> that looks like:</p>
<div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby"><span class="o">&lt;</span><span class="sx">% content_for </span><span class="ss">:image_bleed</span> <span class="k">do</span> <span class="sx">%&gt;</span>
<span class="sx">   &lt;div class=&quot;image-bleed&quot; style=&quot;background-image: url(&lt;%= @random_facility.photo.url %&gt;</span><span class="p">?</span><span class="n">fit</span><span class="o">=</span><span class="n">crop</span><span class="o">&amp;</span><span class="n">h</span><span class="o">=</span><span class="mi">540</span><span class="o">&amp;</span><span class="n">w</span><span class="o">=</span><span class="mi">1280</span><span class="p">)</span><span class="s2">&quot;&gt;&lt;/div&gt;</span>
<span class="s2">&lt;% end %&gt;</span>
</code></pre></div>
<p>The challenge, then, is figuring out how to cache both the image and image detail strings but still allow for image rotation.  Essentially, both &quot;pieces&quot; of the cached content need to be assigned the same cache key so that the matching pair will always load together on subsequent requests.</p>

<p>Michael helped me think through this one, but the solution is brilliantly simple.  Simply puts, use the     <code>@random_lab</code> instance object as the cache key:</p>
<div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby"><span class="o">&lt;</span><span class="sx">% cache </span><span class="vi">@random_lab</span> <span class="k">do</span> <span class="sx">%&gt;</span>
<span class="sx">    # markup and stuffs</span>
<span class="sx">&lt;% end %&gt;</span>
</code></pre></div>
<p>As the app cycles through each random lab promotions when the first users hit the homepage, the page contents are saved to the cache store with a cache key hashed from the <code>@random_lab</code> object, so the pair of the view&#39;s lab image and detail strings are encoded together forever.  Yeah, Michael.  Yeah.</p>

</article>

<nav>
  
    <a class="previous" href="/what-a-front-ender-learned-at-rails-conf/"><span class="arrow">&#10140;</span></a>
  
  
    <a class="next" href="/ada-jadakiss-mashup/"> &#10140;</a>
  
</nav>

<footer><nav>
  
    <a href="/jquery" class="category-nav-item">#jquery</a>
  
    <a href="/rails" class="category-nav-item">#rails</a>
  
    <a href="/backbone" class="category-nav-item">#backbone</a>
  
    <a href="/jekyll" class="category-nav-item">#jekyll</a>
  
    <a href="/sass" class="category-nav-item">#sass</a>
  
    <a href="/javascript" class="category-nav-item">#javascript</a>
  
    <a href="/css" class="category-nav-item">#css</a>
  
    <a href="/conferences" class="category-nav-item">#conferences</a>
  
    <a href="/mashups" class="category-nav-item">#mashups</a>
  
</nav></footer></main>
      <aside>
        <a href="/"><img class="gravatar" src="http://d2ybgnpt0qry0r.cloudfront.net/img/rossy-smalls.png" width="260" height="260"/></a>
        <h1>About Me</h1>
        <p>I'm a web developer who works on the front parts of <a href="http://www.scienceexchange.com">Science Exchange</a>, an online marketplace for scientific collaboration.  I hope my work will quickly lead to the invention of the hover board and hyposprays. Like, <em>quickly</em>.</p>
        <p class="social">
          <a href="http://twitter.com/internetross">twitter</a>
          <a href="www.linkedin.com/in/rosschapmanâ€Ž">linkedin</a>
        </p>
      </aside>
    </div>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-43971638-1');
      ga('send', 'pageview');
    </script>
  </body>
</html>
