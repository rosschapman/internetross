<!DOCTYPE html>
<html>
  <html lang="en">
  <head>
      <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <title>this management, and don't use magic numbers.</title>
      <meta name="viewport" content="width=device-width">
      <meta name="description" content="front-end developer who blogs about shit everyone knows already">
      <link rel="stylesheet" href="/assets/css/syntax.css">
      <link rel="stylesheet" href="/assets/css/main.css">
  </head>
  <body>
    <div class="container">
      <main><article>
  <header>
    <h1>this management, and don't use magic numbers.</h1>
    <time>04 Apr 2014</time>
  </header>
  <h2>just like this</h2>

<p>As you may or may not know, <code>.apply()</code> and <code>.call()</code> are crucial to OOP-ish JavaScript because you&#39;re absolutely going to come across scope issues when writing modular-ly.  Now, JavaScript really only has two scopes, global and function.  But that&#39;s misleadingly simplistic. Because once you shotgun blast your code across multiple files to craft beautiful, &quot;loosely coupled&quot; functions, you need to think global, act global, think local, and act local in every file and code block about...<code>this</code>.</p>

<p>Oh that.  That...thing.  Yes, the most feared of all JavaScript objects. Yes, merely an object like all others.  Not magic.  Just like this.  Zen, brah.</p>

<p>If you use jQuery, you&#39;re already familiar some handy <code>this</code> management, perhaps unbeknownst to you.  In a typical jQuery DOM event method like <code>.click()</code>, the selected (selector-ed?) collection is actually handed to you (i.e., the function callback) as the <code>this</code> object:</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.element&#39;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">);</span> <span class="c1">// prints &lt;div class=&quot;element&gt;&lt;/div&gt;</span>
<span class="p">});</span>
</code></pre></div>
<p><code>$(&#39;.element&#39;)</code> <em>becomes</em> <code>this</code>.</p>

<p><code>this</code> is no longer an object of the outer scope, but an object of the <code>.click()</code> handler callback context.</p>

<p><a href="http://james.padolsey.com/jquery/#v=1.10.2&amp;fn=jQuery.fn.click">Under the hood</a> you can easily find this obfuscated <code>this</code>.  You&#39;ll notice <code>.click()</code> is actually a function wrapper for <a href="http://james.padolsey.com/jquery/#v=1.10.2&amp;fn=jQuery.fn.trigger"><code>.trigger()</code></a> which handles <code>this</code> explicitly as the third argument.  Check it out:</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="nx">jQuery</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
</code></pre></div>
<p>Of course you could go farther up the jQuery source code tree to figure out how trigger works - I encourage it!</p>

<p>jQuery.  A little lightweight context control. But it actually gets more heavyweight.  jQuery is always thinking about making life easier for us.</p>

<p>jQuery takes context management further with a suuuuuper handy method called <a href="https://api.jquery.com/jQuery.proxy/"><code>$.proxy()</code></a>, which wraps around native binder methods  <code>.call()</code> and <code>.apply()</code>.  The syntax for proxy is peasy:</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">thiz</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">.</span><span class="nx">proxy</span><span class="p">(</span><span class="nx">myMethod</span><span class="p">,</span> <span class="k">this</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<p>Can you imagine what&#39;s happening here?  jQuery is actually setting the context of <code>this</code> for myMethod to the <code>this</code> of <code>thiz()</code>&#39;s scope.  Function binding, y&#39;all.  Function binding.  And my attempt to say <em>this</em> like 4 billion times in a blog post.</p>

<p>Tangent: if you worked at Google, you may be familiar with Closure&#39;s <code>.bind()</code> or <code>.bindNative()</code>, which is basically the same <a href="http://docs.closure-library.googlecode.com/git/closure_goog_base.js.source.html#line1016">thing</a> as proxy.  In fact, it&#39;s kinda cool to see a comparison in source:</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="c1">// Closure</span>
<span class="k">if</span> <span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">boundArgs</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
    <span class="k">return</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">newArgs</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">);</span>
        <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">unshift</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">newArgs</span><span class="p">,</span> <span class="nx">boundArgs</span><span class="p">);</span>
        <span class="k">return</span> <span class="nx">fn</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">selfObj</span><span class="p">,</span> <span class="nx">newArgs</span><span class="p">);</span>
        <span class="p">};</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">fn</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">selfObj</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
<span class="p">};</span>

<span class="c1">// jQuery</span>
<span class="nx">args</span> <span class="o">=</span> <span class="nx">core_slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
<span class="nx">proxy</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">fn</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">context</span> <span class="o">||</span> <span class="k">this</span><span class="p">,</span> <span class="nx">args</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">core_slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">)));</span>
<span class="p">};</span>

<span class="k">return</span> <span class="nx">proxy</span><span class="p">;</span>

<span class="p">}</span>
</code></pre></div>
<h2>Magic numbers and code smell</h2>

<p>Do you guys know about magic numbers in programming and why they are bad?</p>

<p>Scott Murray discusses magic numbers in his <a href="http://alignedleft.com/work/d3-book">book about D3</a>, which I was skimming through the other day.  I was then reminded of the article Harry Roberts wrote on <a href="http://csswizardry.com/2012/11/code-smells-in-css/">code smell</a> in CSS - which I read a good while back - which also discusses magic numbers and why they are bad.</p>

<p>Magic numbers are generally integers used in code &quot;just because it works&quot; - as Harry Roberts likes to put it.  He goes on to talk about how you&#39;ll confuse the heck out of other devs who look at your code because a typical developer approaches hard-coded integers with fear.  But that integer is probably just there arbitrarily.  We&#39;ve all put them there before.</p>

<p>In another context, Mr. Murray doesn&#39;t like seeing magic numbers in D3 scale ranges because those numbers might have to change dynamically as data changes.  Of course it&#39;s much easier to work on a meaningfully-named variable than manipulate an integer.</p>

<p>Let&#39;s try some examples.  First, some sample smelly CSS:</p>
<div class="highlight"><pre><code class="sass language-sass" data-lang="sass"><span class="nc">.thang</span>
    <span class="na">position</span><span class="o">:</span> <span class="no">absolute</span>
    <span class="na">top</span><span class="o">:</span> <span class="mi">52</span><span class="kt">px</span>
    <span class="na">left</span><span class="o">:</span> <span class="mi">0</span>
</code></pre></div>
<p>What the eff is that <em>52</em>? Only you and God knows.  Ok, maybe you could add a comment to alert the homies.  But this is not a future-proof solution.  Consider needing a more dynamic number because some browser you are trying to support is painting pixels wrong.  You are a sexy modern web developer who writes Sass which has variables and other magic, might I remind you.  So why not try something like this instead (a little over-complicated for fun):</p>
<div class="highlight"><pre><code class="sass language-sass" data-lang="sass"><span class="nf">=box-top</span><span class="p">(</span><span class="nv">$goBackwards</span><span class="o">,</span> <span class="nv">$size</span><span class="p">)</span>
  <span class="k">@if</span> <span class="nv">$goBackwards</span> <span class="o">==</span> <span class="no">yes</span>
    <span class="na">top</span><span class="o">:</span> <span class="si">#{</span><span class="nv">$size</span><span class="si">}</span><span class="no">px</span>
    <span class="na">top</span><span class="o">:</span> <span class="si">#{</span><span class="p">(</span><span class="nv">$size</span><span class="p">)</span><span class="mi">-1</span><span class="si">}</span><span class="err">\</span><span class="mi">9</span> <span class="c1">// or whatevs hack</span>
  <span class="k">@else</span>
    <span class="na">top</span><span class="o">:</span> <span class="si">#{</span><span class="nv">$size</span><span class="si">}</span><span class="no">px</span>

<span class="nc">.thang</span>
    <span class="na">position</span><span class="o">:</span> <span class="no">absolute</span>
    <span class="na">left</span><span class="o">:</span> <span class="mi">0</span>
    <span class="nd">+box-top</span><span class="p">(</span><span class="no">yes</span><span class="o">,</span> <span class="mi">52</span><span class="p">)</span>
</code></pre></div>
<p>And then a JavaScript example:</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="c1">// BAD</span>
<span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.thang&#39;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="mi">52</span><span class="p">);</span>

<span class="c1">// BETTER</span>
<span class="kd">var</span> <span class="nx">boxTop</span><span class="p">;</span>
<span class="nx">boxTop</span> <span class="o">=</span> <span class="nx">goBackwards</span> <span class="o">?</span> <span class="mi">52</span> <span class="o">:</span> <span class="mi">52</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>

<span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.thang&#39;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="nx">boxTop</span><span class="p">);</span>
</code></pre></div>
<p>Give your code a bath.</p>

</article>

<nav>
  
    <a class="previous" href="/overflow-hidden/"><span class="arrow">&#10140;</span></a>
  
  
    <a class="next" href="/loose-jquery-multistr-and-rails-i18n/"> &#10140;</a>
  
</nav>

<footer><nav>
  
    <a href="/jquery" class="category-nav-item">#jquery</a>
  
    <a href="/rails" class="category-nav-item">#rails</a>
  
    <a href="/backbone" class="category-nav-item">#backbone</a>
  
    <a href="/jekyll" class="category-nav-item">#jekyll</a>
  
    <a href="/sass" class="category-nav-item">#sass</a>
  
    <a href="/javascript" class="category-nav-item">#javascript</a>
  
    <a href="/css" class="category-nav-item">#css</a>
  
    <a href="/conferences" class="category-nav-item">#conferences</a>
  
    <a href="/mashups" class="category-nav-item">#mashups</a>
  
</nav></footer></main>
      <aside>
        <a href="/"><img class="gravatar" src="http://d2ybgnpt0qry0r.cloudfront.net/img/rossy-smalls.png" width="260" height="260"/></a>
        <h1>About Me</h1>
        <p>I'm a web developer who works on the front parts of <a href="http://www.scienceexchange.com">Science Exchange</a>, an online marketplace for scientific collaboration.  I hope my work will quickly lead to the invention of the hover board and hyposprays. Like, <em>quickly</em>.</p>
        <p class="social">
          <a href="http://twitter.com/internetross">twitter</a>
          <a href="www.linkedin.com/in/rosschapmanâ€Ž">linkedin</a>
        </p>
      </aside>
    </div>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-43971638-1');
      ga('send', 'pageview');
    </script>
  </body>
</html>
